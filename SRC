# =============================================
# ğŸ¬ CINEMA UDEARTE - MENÃš PRINCIPAL
# Proyecto Universitario de GestiÃ³n de Cinema
# =============================================

import os
import sys
import time
import re

# ============================
#  MATRIZ DE ASIENTOS
# ============================

filas = ["A","B","C","D","E","F","G","H","I","J","K"]
columnas = ["1","2","3","4","5","6","7","8","9","10","11"]

# 11 filas x 11 columnas llenas de "O"
asientos = [["O" for _ in range(11)] for _ in range(11)]

# Lista global de reservas
reservas = []


# ============================
# Funciones auxiliares
# ============================

def limpiar_pantalla():
    os.system('cls' if os.name == 'nt' else 'clear')

def mostrar_titulo():
    print("===============================================")
    print("      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      ")
    print("     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—     ")
    print("     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘     ")
    print("     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘     ")
    print("     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘     ")
    print("      â•šâ•â•â•â•â•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•     ")
    print("===============================================")
    print("       CINEMA UNIVERSITARIO UDEARTE      ")
    print("===============================================\n")

def mostrar_menu():
    print("Bienvenido al Cinema Universitario UDEARTE\n")
    print("1. Registrar Usuario")
    print("2. Registrar Reserva")
    print("3. Cancelar Reserva")
    print("4. Consultar Funciones Fin de Semana")
    print("5. Administrador")
    print("6. Salir\n")

def pausar():
    input("\nPresiona Enter para continuar...")

# ============================
#  FUNCIÃ“N MOSTRAR ASIENTOS
# ============================

def mostrar_asientos():
    print("\n       CINEMA UDEARTE  (O Disponible | X Ocupado)\n")
    print("      ", end="")
    for c in columnas:
        print(f"{c:3}", end="")
    print()

    for i, fila in enumerate(filas):
        print(f"{fila:3} ", end="")
        for asiento in asientos[i]:
            print(f"{asiento:3}", end="")
        print()
    print()


# ============================
#  MÃ“DULO: Registrar Usuario
# ============================

def registrar_usuario():
    limpiar_pantalla()
    mostrar_titulo()
    print("\n=== REGISTRO DE USUARIO ===\n")

    while True:
        nombre = input("Ingrese el nombre: ").strip().title()
        errores = []
        if len(nombre) < 3:
            errores.append("âŒ El nombre debe tener al menos 3 letras.")
        if any(char.isdigit() for char in nombre):
            errores.append("âŒ El nombre no puede contener nÃºmeros.")
        if errores:
            print("\n".join(errores), "\nIntente de nuevo.\n")
            continue
        break

    while True:
        apellido = input("Ingrese el apellido: ").strip().title()
        errores = []
        if len(apellido) < 3:
            errores.append("âŒ El apellido debe tener al menos 3 letras.")
        if any(char.isdigit() for char in apellido):
            errores.append("âŒ El apellido no puede contener nÃºmeros.")
        if errores:
            print("\n".join(errores), "\nIntente de nuevo.\n")
            continue
        break

    while True:
        documento = input("Ingrese el nÃºmero de documento: ").strip()
        errores = []
        if not documento.isdigit():
            errores.append("âŒ El documento solo debe contener nÃºmeros.")
        if len(documento) < 3 or len(documento) > 15:
            errores.append("âŒ El documento debe tener entre 3 y 15 dÃ­gitos.")
        if errores:
            print("\n".join(errores), "\nIntente de nuevo.\n")
            continue
        break

    tipos_vinculo = {
        "1": ("Estudiante", 7500),
        "2": ("Docente", 10000),
        "3": ("Administrativo", 8500),
        "4": ("Oficial interno", 7000),
        "5": ("PÃºblico externo", 15000)
    }

    print("\nSeleccione el tipo de vÃ­nculo:")
    for clave, (tipo, valor) in tipos_vinculo.items():
        print(f"{clave}. {tipo.ljust(15)} â†’ ${valor:,}") 

    while True:
        opcion = input("\nIngrese el nÃºmero correspondiente: ").strip()
        if opcion not in tipos_vinculo:
            print("âŒ OpciÃ³n no vÃ¡lida.\n")
            continue
        tipo_vinculo, valor_tiquete = tipos_vinculo[opcion]
        break

    print("\n" + "="*40)
    print("âœ… Usuario registrado exitosamente:")
    print(f"Nombre completo   : {nombre} {apellido}")
    print(f"Documento         : {documento}")
    print(f"Tipo de vÃ­nculo   : {tipo_vinculo}")
    print(f"Valor del tiquete : ${valor_tiquete:,}")
    print("="*40)

    time.sleep(1.8)
    pausar()

    return {
        "nombre": nombre,
        "apellido": apellido,
        "documento": documento,
        "vinculo": tipo_vinculo,
        "valor_tiquete": valor_tiquete
    }


# ============================
# REGISTRAR RESERVA
# ============================

def registrar_reserva(usuario):
    limpiar_pantalla()
    mostrar_titulo()
    print("=== REGISTRAR RESERVA ===\n")

    pelicula = input("Ingrese el nombre de la pelÃ­cula: ").strip()

    mostrar_asientos()

    seleccion = input("Seleccione asiento (Ej: A5): ").upper().strip()

    if len(seleccion) < 2:
        print("âŒ SelecciÃ³n invÃ¡lida.")
        pausar()
        return

    fila = seleccion[0]
    columna = seleccion[1:]

    if fila not in filas or columna not in columnas:
        print("âŒ Asiento inexistente.")
        pausar()
        return

    f = filas.index(fila)
    c = columnas.index(columna)

    if asientos[f][c] == "X":
        print("âŒ Ese asiento estÃ¡ ocupado.")
        pausar()
        return

    asientos[f][c] = "X"

    reservas.append({
        "documento": usuario["documento"],
        "pelicula": pelicula,
        "fila": f,
        "columna": c,
        "asiento": seleccion
    })

    print("\nğŸŸ Reserva realizada exitosamente.")
    pausar()


# ============================
# CANCELAR RESERVA
# ============================

def cancelar_reserva(usuario):
    limpiar_pantalla()
    mostrar_titulo()
    print("=== CANCELAR RESERVA ===\n")

    reservas_usuario = [r for r in reservas if r["documento"] == usuario["documento"]]

    if not reservas_usuario:
        print("âŒ No tiene reservas activas.")
        opcion = input("\nÂ¿Desea hacer una reserva? (S/N): ").upper()
        if opcion == "S":
            registrar_reserva(usuario)
        return

    print("Estas son sus reservas activas:\n")
    for i, r in enumerate(reservas_usuario, start=1):
        print(f"{i}. PelÃ­cula: {r['pelicula']}  |  Asiento: {r['asiento']}")

    while True:
        try:
            seleccion = int(input("\nSeleccione cuÃ¡l reserva desea cancelar: "))
            if 1 <= seleccion <= len(reservas_usuario):
                break
            print("âŒ NÃºmero invÃ¡lido.")
        except:
            print("âŒ Ingrese un nÃºmero vÃ¡lido.")

    reserva = reservas_usuario[seleccion - 1]

    confirmar = input(f"\nÂ¿Confirmar cancelaciÃ³n del asiento {reserva['asiento']}? (S/N): ").upper()

    if confirmar != "S":
        print("CancelaciÃ³n abortada.")
        pausar()
        return

    f = reserva["fila"]
    c = reserva["columna"]
    asientos[f][c] = "O"

    reservas.remove(reserva)

    print("\nâœ” Reserva cancelada exitosamente.")
    pausar()


# ============================
# MAIN
# ============================

def main():
    usuario = None

    while True:
        limpiar_pantalla()
        mostrar_titulo()
        mostrar_menu()

        try:
            opcion = int(input("Selecciona una opciÃ³n (1-6): "))
        except ValueError:
            print("\nâš ï¸  Ingrese un nÃºmero vÃ¡lido.")
            time.sleep(1.5)
            continue

        if opcion == 1:
            usuario = registrar_usuario()

        elif opcion == 2:
            if usuario:
                registrar_reserva(usuario)
            else:
                print("\nâš ï¸  Primero debe registrar un usuario.")
                pausar()

        elif opcion == 3:
            if usuario:
                cancelar_reserva(usuario)
            else:
                print("\nâš ï¸  Primero debe registrar un usuario.")
                pausar()

        elif opcion == 4:
            print("\nğŸ“… Funciones del fin de semana prÃ³ximamente.")
            pausar()

        elif opcion == 5:
            print("\nğŸ” MÃ³dulo administrador en construcciÃ³n.")
            pausar()

        elif opcion == 6:
            print("\nGracias por usar CINEMA UDEARTE ğŸ¬")
            time.sleep(1.5)
            limpiar_pantalla()
            sys.exit()

        else:
            print("\nâš ï¸ OpciÃ³n fuera de rango.")
            time.sleep(1.5)


if __name__ == "__main__":
    main()
