# =============================================
#     ğŸ¬ CINEMA UDEARTE - MENÃš PRINCIPAL
# Proyecto Universitario de GestiÃ³n de Cinema
# =============================================

import os
import sys
import time
import re

# ============================
#     MATRIZ DE ASIENTOS
# ============================

filas = ["A","B","C","D","E","F","G","H","I","J","K"]
columnas = ["1","2","3","4","5","6","7","8","9","10","11"]

asientos = [["O" for _ in range(11)] for _ in range(11)]

# Listas globales
reservas = []
usuarios_registrados = []

# ============================
#   ADMINISTRADORES VALIDOS
# ============================
admin_credenciales = {
    "admin1": "1234",
    "jonhy": "2025",
    "root": "admin"
}

# ============================
#   FUNCIONES FIN DE SEMANA
# ============================

funciones_fin_semana = [
    {"id": 1, "dia": "Viernes", "hora": "2pm", "pelicula": "Interstellar", "disponibles": 100},
    {"id": 1, "dia": "Viernes", "hora": "4pm", "pelicula": "Interstellar", "disponibles": 5},
    {"id": 1, "dia": "Viernes", "hora": "6pm", "pelicula": "Interstellar", "disponibles": 50},

    {"id": 2, "dia": "Sabado", "hora": "2pm", "pelicula": "Oppenheimer", "disponibles": 23},
    {"id": 2, "dia": "Sabado", "hora": "4pm", "pelicula": "Oppenheimer", "disponibles": 44},
    {"id": 2, "dia": "Sabado", "hora": "6pm", "pelicula": "Oppenheimer", "disponibles": 66},

    {"id": 3, "dia": "Domingo", "hora": "2pm", "pelicula": "The Imitation Game", "disponibles": 11},
    {"id": 3, "dia": "Domingo", "hora": "4pm", "pelicula": "The Imitation Game", "disponibles": 0},
    {"id": 3, "dia": "Domingo", "hora": "6pm", "pelicula": "The Imitation Game", "disponibles": 7},
]

# FUNCIONES PROXIMO FIN DE SEMANA
funciones_proximo = [
    {"id": 4, "dia": "Viernes", "hora": "1pm", "pelicula": "Dune", "disponibles": 80},
    {"id": 4, "dia": "Viernes", "hora": "4pm", "pelicula": "Dune", "disponibles": 60},
    {"id": 4, "dia": "Viernes", "hora": "7pm", "pelicula": "Dune", "disponibles": 40},

    {"id": 5, "dia": "Sabado", "hora": "3pm", "pelicula": "Whiplash", "disponibles": 50},
    {"id": 5, "dia": "Sabado", "hora": "5pm", "pelicula": "Whiplash", "disponibles": 45},
    {"id": 5, "dia": "Sabado", "hora": "9pm", "pelicula": "Whiplash", "disponibles": 30},

    {"id": 6, "dia": "Domingo", "hora": "12pm", "pelicula": "Parasite", "disponibles": 70},
    {"id": 6, "dia": "Domingo", "hora": "3pm", "pelicula": "Parasite", "disponibles": 55},
    {"id": 6, "dia": "Domingo", "hora": "8pm", "pelicula": "Parasite", "disponibles": 20},
]

# ============================
#    Funciones auxiliares
# ============================

def limpiar_pantalla():
    os.system('cls' if os.name == 'nt' else 'clear')

def mostrar_titulo():
    print("===============================================")
    print("      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      ")
    print("     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—     ")
    print("     â–ˆâ–ˆâ•‘     â–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆ  â•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘     ")
    print("     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘     ")
    print("     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘     ")
    print("      â•šâ•â•â•â•â•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•     ")
    print("===============================================")
    print("        CINEMA UNIVERSITARIO UDEARTE      ")
    print("===============================================\n")

def mostrar_menu():
    print("Bienvenido al Cinema Universitario UDEARTE\n")
    print("1. Registrar Usuario")
    print("2. Registrar Reserva")
    print("3. Cancelar Reserva")
    print("4. Consultar Funciones Fin de Semana")
    print("5. Administrador")
    print("6. Salir\n")

def pausar():
    input("\nPresiona Enter para continuar...")

def mostrar_asientos():
    print("\n       CINEMA UDEARTE  (O Disponible | X Ocupado)\n")
    print("      ", end="")
    for c in columnas:
        print(f"{c:3}", end="")
    print()

    for i, fila in enumerate(filas):
        print(f"{fila:3} ", end="")
        for asiento in asientos[i]:
            print(f"{asiento:3}", end="")
        print()
    print()

def imprimir_cartelera(lista):
    print("-"*72)
    print(f"{'No.':<4} {'IdPel':<6} {'DÃ­a':<10} {'Hora':<6} {'PelÃ­cula':<28} {'Disponibles':>8}")
    print("-"*72)
    orden_dias = {"Viernes": 1, "Sabado": 2, "Domingo": 3}
    lista_ordenada = sorted(lista, key=lambda x: (orden_dias.get(x["dia"], 99), x["hora"], x["pelicula"]))
    for idx, f in enumerate(lista_ordenada, start=1):
        print(f"{idx:<4} {f['id']:<6} {f['dia']:<10} {f['hora']:<6} {f['pelicula']:<28} {f['disponibles']:>8}")
    print("-"*72)

def obtener_funciones_por_pelicula(lista_funciones, nombre_pelicula):
    return [f for f in lista_funciones if f["pelicula"].lower() == nombre_pelicula.lower()]


# ============================
#     REGISTRAR USUARIO
# ============================

def registrar_usuario():
    limpiar_pantalla()
    mostrar_titulo()
    print("\n=== REGISTRO DE USUARIO ===\n")

    while True:
        nombre = input("Ingrese el nombre: ").strip().title()
        if len(nombre) < 3 or any(char.isdigit() for char in nombre):
            print("âŒ Nombre invÃ¡lido.\n")
            continue
        break

    while True:
        apellido = input("Ingrese el apellido: ").strip().title()
        if len(apellido) < 3 or any(char.isdigit() for char in apellido):
            print("âŒ Apellido invÃ¡lido.\n")
            continue
        break

    while True:
        documento = input("Ingrese el nÃºmero de documento: ").strip()
        if not documento.isdigit():
            print("âŒ El documento debe ser numÃ©rico.\n")
            continue
        break

    tipos_vinculo = {
        "1": ("Estudiante", 7500),
        "2": ("Docente", 10000),
        "3": ("Administrativo", 8500),
        "4": ("Oficial interno", 7000),
        "5": ("PÃºblico externo", 15000)
    }

    print("\nSeleccione el tipo de vÃ­nculo:")
    for k, v in tipos_vinculo.items():
        print(f"{k}. {v[0]} â†’ ${v[1]:,}")

    while True:
        opcion = input("\nIngrese una opciÃ³n: ").strip()
        if opcion not in tipos_vinculo:
            print("âŒ OpciÃ³n invÃ¡lida.")
            continue
        vinculo, valor = tipos_vinculo[opcion]
        break

    usuario = {
        "nombre": nombre,
        "apellido": apellido,
        "documento": documento,
        "vinculo": vinculo,
        "valor_tiquete": valor
    }

    usuarios_registrados.append(usuario)

    print("\nUsuario registrado con Ã©xito.")
    pausar()
    return usuario

# ============================
#     REGISTRAR RESERVA
# ============================

def registrar_reserva(usuario):
    limpiar_pantalla()
    mostrar_titulo()
    print("=== REGISTRAR RESERVA ===\n")

    imprimir_cartelera(funciones_fin_semana)
    peliculas = sorted(list({f["pelicula"] for f in funciones_fin_semana}))

    print("\nPelÃ­culas disponibles:")
    for i, p in enumerate(peliculas, 1):
        print(f"{i}. {p}")

    while True:
        opcion = input("\nSeleccione pelÃ­cula: ")
        if opcion.isdigit() and 1 <= int(opcion) <= len(peliculas):
            pelicula_sel = peliculas[int(opcion)-1]
            break

    funciones = obtener_funciones_por_pelicula(funciones_fin_semana, pelicula_sel)

    print(f"\nFunciones para {pelicula_sel}:")
    for i, f in enumerate(funciones, 1):
        print(f"{i}. {f['dia']} {f['hora']} | {f['disponibles']} disponibles")

    while True:
        opcion_f = input("\nSeleccione funciÃ³n: ")
        if opcion_f.isdigit() and 1 <= int(opcion_f) <= len(funciones):
            funcion_sel = funciones[int(opcion_f)-1]
            break

    if funcion_sel["disponibles"] <= 0:
        print("âŒ No hay sillas disponibles.")
        pausar()
        return

    mostrar_asientos()
    seleccion = input("Seleccione asiento (Ej: B5): ").upper().strip()
    fila = seleccion[0]
    col = seleccion[1:]

    if fila not in filas or col not in columnas:
        print("âŒ Asiento inexistente.")
        pausar()
        return

    f_idx = filas.index(fila)
    c_idx = columnas.index(col)

    if asientos[f_idx][c_idx] == "X":
        print("âŒ Asiento ocupado.")
        pausar()
        return

    asientos[f_idx][c_idx] = "X"
    funcion_sel["disponibles"] -= 1

    reserva = {
        "documento": usuario["documento"],
        "pelicula": funcion_sel["pelicula"],
        "dia": funcion_sel["dia"],
        "hora": funcion_sel["hora"],
        "asiento": seleccion,
        "fila": f_idx,
        "columna": c_idx,
        "pago": usuario["valor_tiquete"]
    }

    reservas.append(reserva)

    print("\nReserva completada.")
    pausar()

# ============================
#      CANCELAR RESERVA
# ============================

def cancelar_reserva(usuario):
    limpiar_pantalla()
    mostrar_titulo()
    print("=== CANCELAR RESERVA ===\n")

    res_user = [r for r in reservas if r["documento"] == usuario["documento"]]

    if not res_user:
        print("No tiene reservas.")
        pausar()
        return

    print("Sus reservas:")
    for i, r in enumerate(res_user, 1):
        print(f"{i}. {r['pelicula']} | {r['dia']} {r['hora']} | {r['asiento']}")

    while True:
        sel = input("\nSeleccione una reserva: ")
        if sel.isdigit() and 1 <= int(sel) <= len(res_user):
            reserva = res_user[int(sel)-1]
            break

    f, c = reserva["fila"], reserva["columna"]
    asientos[f][c] = "O"

    for f in funciones_fin_semana:
        if f["pelicula"] == reserva["pelicula"] and f["dia"] == reserva["dia"] and f["hora"] == reserva["hora"]:
            f["disponibles"] += 1

    reservas.remove(reserva)

    print("Reserva cancelada.")
    pausar()

# ============================
#    MODULO ADMINISTRADOR
# ============================

def admin_login():
    limpiar_pantalla()
    mostrar_titulo()
    print("=== ACCESO ADMINISTRADOR ===\n")

    usuario = input("Usuario: ").strip()
    clave = input("ContraseÃ±a: ").strip()

    if usuario in admin_credenciales and admin_credenciales[usuario] == clave:
        print("\nâœ” Acceso concedido.")
        time.sleep(1)
        admin_menu()
    else:
        print("\nâŒ Credenciales incorrectas.")
        pausar()


def admin_menu():
    while True:
        limpiar_pantalla()
        mostrar_titulo()
        print("=== MENÃš ADMINISTRADOR ===\n")
        print("1. Total de reservas registradas")
        print("2. Total de tiquetes vendidos")
        print("3. Total de reservas realizadas")
        print("4. Total pago realizado")
        print("5. Promedio por venta diario")
        print("6. Lista de usuarios")
        print("7. Usuario con mÃ¡s y menos reservas")
        print("8. Salir\n")

        opcion = input("Seleccione una opciÃ³n: ")

        if opcion == "1":
            print("\nTotal reservas registradas:", len(reservas))
            pausar()

        elif opcion == "2":
            print("\nTiquetes vendidos:", len(reservas))
            pausar()

        elif opcion == "3":
            print("\nTotal reservas realizadas:", len(reservas))
            pausar()

        elif opcion == "4":
            total_pago = sum(r["pago"] for r in reservas)
            print("\nTotal pago recibido: $", total_pago)
            pausar()

        elif opcion == "5":
            dias = 3
            total = sum(r["pago"] for r in reservas)
            print("\nPromedio de venta diario: $", round(total/dias, 2))
            pausar()

        elif opcion == "6":
            print("\nUsuarios registrados:")
            for u in usuarios_registrados:
                print(f"- {u['nombre']} {u['apellido']} ({u['documento']})")
            pausar()

        elif opcion == "7":
            if not reservas:
                print("No hay reservas.")
                pausar()
                continue

            conteo = {}
            for r in reservas:
                conteo[r["documento"]] = conteo.get(r["documento"], 0) + 1

            max_doc = max(conteo, key=conteo.get)
            min_doc = min(conteo, key=conteo.get)

            u_max = next(u for u in usuarios_registrados if u["documento"] == max_doc)
            u_min = next(u for u in usuarios_registrados if u["documento"] == min_doc)

            print("\nUsuario con MÃS reservas:", u_max["nombre"], u_max["apellido"], "-", conteo[max_doc])
            print("Usuario con MENOS reservas:", u_min["nombre"], u_min["apellido"], "-", conteo[min_doc])
            pausar()

        elif opcion == "8":
            break

# ============================
#          MAIN
# ============================

def main():
    usuario = None

    while True:
        limpiar_pantalla()
        mostrar_titulo()
        mostrar_menu()

        opcion = input("Seleccione una opciÃ³n: ")

        if opcion == "1":
            usuario = registrar_usuario()

        elif opcion == "2":
            if usuario:
                registrar_reserva(usuario)
            else:
                print("Debe registrar usuario.")
                pausar()

        elif opcion == "3":
            if usuario:
                cancelar_reserva(usuario)
            else:
                print("Debe registrar usuario.")
                pausar()

        elif opcion == "4":
            imprimir_cartelera(funciones_proximo)
            pausar()

        elif opcion == "5":
            admin_login()

        elif opcion == "6":
            print("\nGracias por usar CINEMA UDEARTE ğŸ¬")
            break

if __name__ == "__main__":
    main()
